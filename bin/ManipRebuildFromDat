#! /usr/bin/env python
"""

This program rebuilds a pymanip HDF5 file from the ASCII
dat file.

"""

from pathlib import Path
import pandas as pd

from pymanip import Session
from argparse import ArgumentParser

def main(inputDatfile, outputSessionName):
    with inputDatfile.open() as in_f:
        data = pd.read_csv(in_f, sep=' ')        
        liste_var = list(data.keys())
        liste_var.remove('Time')
        MI = Session(outputSessionName, liste_var)
        for line in data.iterrows():
            MI.log_addline(timestamp=line[1].Time, 
                           dict_caller=dict(line[1]))
        MI.Stop()

if __name__ == '__main__':
    parser = ArgumentParser(description=__doc__)
    parser.add_argument('input_file', help='Input ASCII file')
    parser.add_argument('output_name', help='Output MI session name')
    args = parser.parse_args()
    main(Path(args.input_file), args.output_name)
